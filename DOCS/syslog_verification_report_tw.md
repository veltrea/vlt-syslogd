# Syslog 驗證最終報告：實際工具中的編碼行為

## 1. 驗證目的
證明 RFC 5424 規範（UTF-8 時必須包含 BOM）與實際 Syslog 發送工具行為之間的差異，並確認所實現的「寬容解析 (Tolerant Parsing)」的有效性。

## 2. 驗證環境
- **伺服器**: `vlt-syslog-portable` (Mac 192.168.1.22)
- **用戶端 1 (Mac)**: `nc` (netcat), `logger`
- **用戶端 2 (Windows)**: `LLM-SVR1` (PowerShell .NET)

## 3. 驗證結果：實際設備的「原始數據」分析

記錄在 `logs/debug_raw.log` 中的接收封包 (HEX) 的分析結果。

| 發送工具 / 格式 | 預期行為 (RFC) | 實際行為 (RAW) | 判定結果 | 備註 |
| :--- | :--- | :--- | :--- | :--- |
| **Mac `nc` (UTF-8)** | 有 BOM | **無 BOM** | ✅ UTF-8 (隱式) | 即使手動發送，遺漏 BOM 的情況也很常見 |
| **Windows PowerShell** | 有 BOM | **無 BOM** | ✅ UTF-8 (隱式) | 確認受 .NET 標準行為影響而缺失 BOM |
| **MegaLog / 各種 SD** | 按指定 | 按指定 | ✅ 各種字元集 | SD `charset` 參數具有極高的可靠性 |
| **Legacy (RFC 3164)** | 無規定 | 無 BOM (SJIS等) | ✅ Shift_JIS/Big5 (判定) | 通過統計推測正確還原 CJK 字元 |

## 4. 關於「BOM 陷阱」處理與解決方案
通過本次驗證，明確了 **「僅依靠 BOM 是否存在來解析在現實世界中是行不通的」**。

### 現狀
- 在 Windows 的標準發送（如 PowerShell）中，即使是 UTF-8 通常也不帶 BOM。
- 如果將其視為「沒有 BOM 所以是亂碼（或無效數據）」，現代系統的日誌將全部顯示亂碼。

### 我們的解決方案（三層邏輯）
1. **BOM 檢測**: 如果存在，則 100% 視為 UTF-8。
2. **SD (Structured Data) 解析**: 分析 `charset` 標籤（`UTF-8`, `MSG-UTF8`, `Shift_JIS` 等）進行還原。
3. **統計推定 (最後防線)**: 通過 `chardetng` 根據位元組序列特徵為中日韓環境做出最優判定。

## 5. 結論
事實證明，`vlt-syslog-portable` 在尊重 RFC 理想的同時，對現實世界中的「不完全數據」具有極高的適應性。這使得在多平台混合環境中也能實現無亂碼的穩定日誌監控。

---

> [!IMPORTANT]
> **致全球用戶的一封信**
> 目前開發者的測試環境**僅限於日語環境**。雖然我們已經確認了對主要編碼的支援，但如果您在所在地區（繁體中文、英文、韓文、越南語等）遇到顯示問題或「亂碼」，請務必向我們報告。期待您的回饋！
